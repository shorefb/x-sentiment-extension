document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("toggle"),t=document.getElementById("reset"),n=document.getElementById("stats"),o=document.getElementById("needle"),r=document.getElementById("meter-label"),a=document.getElementById("gauge-label"),s=new Map;function c(){let e=0,t=0,c=0,l=0;s.forEach((n=>{"Positive"===n?(e++,l+=1):"Negative"===n?(t++,l-=1):"Neutral"===n&&c++}));const d=e+t+c;n.innerHTML=`\n      Positive: ${e}<br>\n      Negative: ${t}<br>\n      Neutral: ${c}\n    `;const E=d>0?l/d:0;let m;m=E>0?50+50*E:50*(1+E);const i=m/100*180-90;o.style.transform=`rotate(${i}deg)`;let g="",u="";E>0?(g="POSITIVE",u="#28a745"):E<0?(g="NEGATIVE",u="#dc3545"):(g="NEUTRAL",u="#6c757d"),console.log("Setting gauge label to:",g,"with color:",u),a.textContent=g,a.style.color=u,r.textContent=`Overall Sentiment: ${E.toFixed(2)} (${d} posts)`}chrome.storage.local.get(["enabled"],(t=>{const n=!1!==t.enabled;e.textContent=n?"Turn Off":"Turn On"})),e.addEventListener("click",(()=>{chrome.storage.local.get(["enabled"],(t=>{const n=!(!1!==t.enabled);chrome.storage.local.set({enabled:n}),e.textContent=n?"Turn Off":"Turn On",chrome.tabs.query({active:!0,currentWindow:!0},(e=>{chrome.tabs.reload(e[0].id)}))}))})),t.addEventListener("click",(()=>{s.clear(),chrome.runtime.sendMessage({type:"RESET_SENTIMENTS"}),c()})),c(),chrome.runtime.onMessage.addListener(((e,t,n)=>{"SENTIMENT_UPDATED"===e.type?(e.sentiments.forEach((([e,t])=>{s.has(e)||s.set(e,t)})),c(),n({received:!0})):"SENTIMENTS_RESET"===e.type&&(s.clear(),c(),n({received:!0}))})),chrome.runtime.sendMessage({type:"REQUEST_SENTIMENT"},(e=>{e&&e.sentiments&&(e.sentiments.forEach((([e,t])=>{s.has(e)||s.set(e,t)})),c())}))}));